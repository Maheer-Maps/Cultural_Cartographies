<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Borough: Bromley</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,200..800&family=Cormorant:ital,wght@0,300..700;1,300..700&family=EB+Garamond:ital,wght@0,400..800;1,400..800&family=Manrope:wght@200..800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Rubik+Mono+One&family=Special+Gothic+Expanded+One&family=Tilt+Warp&family=Urbanist:wght@100..900&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 60px;
      font-family: "EB Garamond", serif;
      background-color: #333432;
      color: white;
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr 1fr;
      height: 100vh;
      gap: 10px;
      box-sizing: border-box;
    }

    .box {
      background-color: #333432;
      border-radius: 10px;
      padding: 40px;
      display: flex;
      flex-direction: column;
      color: white;
      /* Make sure boxes don't overflow */
      overflow: hidden;
    }

    #title-box {
}

    #graphs-box {
      position: relative;
      display: flex;
      flex-direction: column;
    }

    #map-title {
      position: absolute;
      top: 30px;
      left: 0;
      right: 0;
      text-align: center;
      font-size: 1.4rem;
      font-weight: 600;
      color: white;
      z-index: 10;
      font-family: "Bricolage Grotesque", sans-serif;
    }

    #main {
      /* Map chart container fills available space below title */
      flex-grow: 1;
      margin-top: 40px;
  
    }

    #photo-box {
      /* Make sure photo-box is a flex container centered horizontally and vertically */
      display: flex;
      justify-content: center;
      align-items: center;
      /* Crucial: fix height so chart can fill exactly */
      /* Let's use 100% height and width to fill the box */
      width: 100%;
      height: 100%;
      padding: 0;
      position: relative;
    }

    /* The bar chart container must fill #photo-box */
    #main-bar-chart {
      width: 100%;
      height: 100%;
    
    }

    #quote-box {
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 20px;
    }

    h1 {
      font-size: 2.5rem;
  font-family: 'Bricolage Grotesque', sans-serif;
  text-transform: uppercase;
  color: #D9D9D9;
  padding: 0px 40px 20px;
  margin: 0;
}
    

    #quote {
      font-size: 1.8rem;
      font-style: italic;
      font-weight: 600;
      max-width: 80%;
    }
  </style>
</head>
<body>
  <div class="box" id="title-box">
    <h1>Borough: Bromley</h1>
    <p>Bromley Local Plan 2019 : Produce healthier environments and infrastructure to support people in living fuller, longer, healthier, and more sustainable lives. The Council will support the maximisation of opportunities for the enhancement or the creation of social infrastructure, to address the needs of existing and future residents of all ages…encouraging the development of community “hubs” providing a range of social infrastructure on accessible existing community sites or in retail centres or within new major developments.

        Bromley Regeneration Strategy 2020-2030 : Emphasizes the importance of preserving and nurturing green spaces, promoting sustainability, achieving high-quality leisure and cultural offerings. Often the borough’s talented and creative past and present is overlooked.</p>
  </div>

  <div class="box" id="graphs-box">
    <div id="map-title">Cinema Rate of Change in London Boroughs (2017-2025)</div>
    <div id="main"></div>
  </div>

  <div class="box" id="photo-box">
    <div id="main-bar-chart"></div>
  </div>

  <div class="box" id="quote-box">
    <p id="quote">
      "Museums and galleries have seen an 8% decline since the last data
      capture."
    </p>
  </div>

  <script>
    // London Borough map chart (unchanged)
    var chartDom = document.getElementById("main");
    var myChart = echarts.init(chartDom);

    myChart.showLoading();

    var LONDON_GEOJSON_URL =
      "https://raw.githubusercontent.com/radoi90/housequest-data/master/london_boroughs.geojson";

    $.get(LONDON_GEOJSON_URL, function (londonJson) {
      myChart.hideLoading();

      echarts.registerMap("London", londonJson);

      var allBoroughs = [
        "Barking and Dagenham",
        "Barnet",
        "Bexley",
        "Brent",
        "Bromley",
        "Camden",
        "City of London",
        "Croydon",
        "Ealing",
        "Enfield",
        "Greenwich",
        "Hackney",
        "Hammersmith and Fulham",
        "Haringey",
        "Harrow",
        "Havering",
        "Hillingdon",
        "Hounslow",
        "Islington",
        "Kensington and Chelsea",
        "Kingston upon Thames",
        "Lambeth",
        "Lewisham",
        "Merton",
        "Newham",
        "Redbridge",
        "Richmond upon Thames",
        "Southwark",
        "Sutton",
        "Tower Hamlets",
        "Waltham Forest",
        "Wandsworth",
        "Westminster",
      ];

      var rawData = [
        0.0, 0.0, 0.0, 0.0, 0.2, 0.33, 0.2, 0.0, 1.0, -1.0, 0.0, 1.0, 0.0, 0.2,
        -0.33, -0.2, 0.0, 0.6, 0.5, 0.0, 0.0, 0.14, 0.33, 0.0, -0.2, 1.0, 0.0,
        0.0, 0.0, 0.08, 0.0, 0.5, -0.04,
      ];

      const purpleGradient = [
        "#F3E8FF",
        "#D9C6FF",
        "#C2A0F2",
        "#A175E6",
        "#7B4FCC",
        "#6A4CDB",
        "#4B35B5",
      ];

      const greyGradient = [
        "#CCCCCC",
        "#AAAAAA",
        "#888888",
        "#666666",
        "#444444",
        "#222222",
        "#111111",
      ];

      function getColor(val) {
        if (val > 0) {
          let index = Math.min(6, Math.floor(val * 7));
          return purpleGradient[index];
        } else if (val < 0) {
          let index = Math.min(6, Math.floor(Math.abs(val) * 7));
          return greyGradient[index];
        } else {
          return "#777777";
        }
      }

      var data = allBoroughs.map(function (name, i) {
        return {
          name: name,
          value: rawData[i],
          itemStyle: {
            color: getColor(rawData[i]),
            borderColor: name === "Bromley" ? "#FFFFFF" : "#666666",
            borderWidth: name === "Bromley" ? 3 : 1,
          },
          tooltipData:
            name +
            "<br/><span style='color:#333333'>Change: " +
            rawData[i].toFixed(2) +
            "</span>",
        };
      });

      const mapOption = {
        tooltip: {
          trigger: "item",
          formatter: function (params) {
            return (
              "<strong style='color:#333333'>" + params.data.tooltipData + "</strong>"
            );
          },
          backgroundColor: "#ffffff",
          borderColor: "#999999",
          borderWidth: 1,
          textStyle: {
            color: "#333333",
            fontFamily: "Poppins",
          },
        },
        visualMap: {
          show: false,
        },
        series: [
          {
            id: "cinema_change",
            type: "map",
            roam: true,
            map: "London",
            data: data,
            itemStyle: {
              borderColor: "#666666",
            },
            emphasis: {
              itemStyle: {
                areaColor: "#555555",
                borderColor: "#FFFFFF",
                borderWidth: 2,
              },
              label: {
                color: "white",
                fontWeight: "600",
              },
            },
            label: {
              color: "white",
              fontFamily: "Poppins",
            },
          },
        ],
      };

      myChart.setOption(mapOption);
    });

    window.addEventListener("resize", function () {
      myChart.resize();
    });
  </script>

  <script>
    // Bar chart inside photo-box

    var chartDomBar = document.getElementById("main-bar-chart");
    var myChartBar = echarts.init(chartDomBar);

    var datasets = [
      {
        title: "Number of Cinemas per Borough: Bromley vs London Average",
        yAxisName: "Number of Cinemas",
        yMax: 5,
        data: [3, 3.72727273],
      },
      {
        title: "Number of Cinemas Normalized per Hectare per Population",
        yAxisName: "Normalized Cinemas",
        yMax: 30,
        data: [7.4, 28.40362069],
      },
    ];

    var categories = ["Bromley", "London Average"];

    function getOption(index) {
      return {
        backgroundColor: "#333333",
        title: {
          text: datasets[index].title,
          left: "center",
          textStyle: {
            color: "white",
            fontFamily: "Poppins",
            fontSize: 18,
            fontWeight: 600,
          },
        },
        tooltip: {
          trigger: "axis",
          axisPointer: { type: "shadow" },
          textStyle: { fontFamily: "Poppins" },
        },
        xAxis: {
          type: "category",
          data: categories,
          name: "Borough",
          nameLocation: "middle",
          nameGap: 30,
          axisLine: { lineStyle: { color: "#ccc" } },
          axisLabel: { color: "white", fontFamily: "Poppins" },
          nameTextStyle: { color: "white", fontFamily: "Poppins", fontSize: 14 },
        },
        yAxis: {
          type: "value",
          min: 0,
          max: datasets[index].yMax,
          name: datasets[index].yAxisName,
          nameLocation: "middle",
          nameGap: 50,
          axisLine: { lineStyle: { color: "#ccc" } },
          splitLine: { lineStyle: { color: "#555" } },
          axisLabel: { color: "white", fontFamily: "Poppins" },
          nameTextStyle: { color: "white", fontFamily: "Poppins", fontSize: 14 },
        },
        series: [
          {
            name: datasets[index].yAxisName,
            type: "bar",
            data: datasets[index].data,
            itemStyle: {
              color: function (params) {
                return params.dataIndex === 0 ? "#C2A0F2" : "#CCCCCC";
              },
            },
            barWidth: "40%",
            emphasis: {
              focus: "series",
            },
          },
        ],
        animationDuration: 1000,
        animationEasing: "cubicOut",
        animationDurationUpdate: 1000,
        animationEasingUpdate: "cubicOut",
      };
    }

    var currentIndex = 0;
    myChartBar.setOption(getOption(currentIndex));

    setInterval(() => {
      currentIndex = (currentIndex + 1) % datasets.length;
      myChartBar.setOption(getOption(currentIndex));
    }, 4000);

    window.addEventListener("resize", function () {
      myChartBar.resize();
    });
  </script>
</body>
</html>
