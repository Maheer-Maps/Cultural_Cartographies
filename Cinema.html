<!DOCTYPE html>
<html style="height: 100%">
<head>
  <meta charset="UTF-8">
  <title>Number of Cinemas per Borough Vs Cinema Economic Accessibility</title>
  <!-- ECharts -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  <!-- jQuery for AJAX -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- Poppins font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap" rel="stylesheet">
  <style>
    body, html {
      height: 100%;
      margin: 0;
      background-color: #333333;
      font-family: 'Poppins', sans-serif;
    }
    #main {
      height: 100%;
      width: 100%;
    }
  </style>
</head>
<body>
  <div id="main"></div>
  <script>
    var chartDom = document.getElementById('main');
    var myChart = echarts.init(chartDom, null, {
      fontFamily: 'Poppins, sans-serif'
    });

    myChart.showLoading();

    var LONDON_GEOJSON_URL = 'https://raw.githubusercontent.com/radoi90/housequest-data/master/london_boroughs.geojson';

    $.get(LONDON_GEOJSON_URL, function (londonJson) {
      myChart.hideLoading();

      echarts.registerMap('London', londonJson);

      var data = [
        { name: 'Barking and Dagenham', value: 1 },
        { name: 'Barnet', value: 3 },
        { name: 'Bexley', value: 1 },
        { name: 'Brent', value: 3 },
        { name: 'Bromley', value: 3 },
        { name: 'Camden', value: 14 },
        { name: 'City of London', value: 2 },
        { name: 'Croydon', value: 3 },
        { name: 'Ealing', value: 1 },
        { name: 'Enfield', value: 2 },
        { name: 'Greenwich', value: 4 },
        { name: 'Hackney', value: 5 },
        { name: 'Hammersmith and Fulham', value: 4 },
        { name: 'Haringey', value: 5 },
        { name: 'Harrow', value: 1 },
        { name: 'Havering', value: 1 },
        { name: 'Hillingdon', value: 2 },
        { name: 'Hounslow', value: 3 },
        { name: 'Islington', value: 3 },
        { name: 'Kensington and Chelsea', value: 7 },
        { name: 'Kingston upon Thames', value: 1 },
        { name: 'Lambeth', value: 7 },
        { name: 'Lewisham', value: 2 },
        { name: 'Merton', value: 2 },
        { name: 'Newham', value: 2 },
        { name: 'Redbridge', value: 2 },
        { name: 'Richmond upon Thames', value: 3 },
        { name: 'Southwark', value: 7 },
        { name: 'Sutton', value: 0 },
        { name: 'Tower Hamlets', value: 6 },
        { name: 'Waltham Forest', value: 0 },
        { name: 'Wandsworth', value: 3 },
        { name: 'Westminster', value: 20 }
      ];

      var barData = [
        { name: 'Barking and Dagenham', value: 0.069 },
        { name: 'Barnet', value: 0.177 },
        { name: 'Bexley', value: 0.061 },
        { name: 'Brent', value: 0.196 },
        { name: 'Bromley', value: 0.154 },
        { name: 'Camden', value: 0.77 },
        { name: 'City of London', value: 0.218 },
        { name: 'Croydon', value: 0.175 },
        { name: 'Ealing', value: 0.062 },
        { name: 'Enfield', value: 0.131 },
        { name: 'Greenwich', value: 0.225 },
        { name: 'Hackney', value: 0.276 },
        { name: 'Hammersmith and Fulham', value: 0.211 },
        { name: 'Haringey', value: 0.29 },
        { name: 'Harrow', value: 0.063 },
        { name: 'Havering', value: 0.059 },
        { name: 'Hillingdon', value: 0.122 },
        { name: 'Hounslow', value: 0.192 },
        { name: 'Islington', value: 0.156 },
        { name: 'Kensington and Chelsea', value: 0.364 },
        { name: 'Kingston upon Thames', value: 0.058 },
        { name: 'Lambeth', value: 0.37 },
        { name: 'Lewisham', value: 0.119 },
        { name: 'Merton', value: 0.117 },
        { name: 'Newham', value: 0.133 },
        { name: 'Redbridge', value: 0.126 },
        { name: 'Richmond upon Thames', value: 0.154 },
        { name: 'Southwark', value: 0.374 },
        { name: 'Sutton', value: 0 },
        { name: 'Tower Hamlets', value: 0.33 },
        { name: 'Waltham Forest', value: 0 },
        { name: 'Wandsworth', value: 0.15 },
        { name: 'Westminster', value: 1 }
      ];

      // Sort data alphabetically for bar chart
      barData.sort(function(a, b) {
        return a.name.localeCompare(b.name);
      });

      const mapOption = {
        title: {
          text: 'Number of Cinemas per Borough Vs Cinema Economic Accessibility',
          left: 'center',
          textStyle: {
            color: '#ffffff',
            fontFamily: 'Poppins, sans-serif'
          }
        },
        tooltip: {
          trigger: 'item',
          textStyle: {
            color: '#ffffff',
            fontFamily: 'Poppins, sans-serif'
          },
          backgroundColor: '#333333'
        },
        visualMap: {
          left: 'right',
          min: 1,
          max: 20,
          inRange: {
            color: ['#9a63ff', '#a2dff5', '#5EF275'] // Updated colors: purple to blue to green
          },
          text: ['High', 'Low'],
          textStyle: {
            color: '#ffffff',
            fontFamily: 'Poppins, sans-serif'
          },
          calculable: true,
        },
        series: [
          {
            id: 'libraries_change',
            type: 'map',
            roam: true,
            map: 'London',
            animationDurationUpdate: 1000,
            universalTransition: true,
            data: data,
            itemStyle: {
              areaColor: '#333333'
            },
            emphasis: {
              label: {
                color: '#ffffff',
                fontFamily: 'Poppins, sans-serif'
              }
            },
            label: {
              color: '#ffffff',
              fontFamily: 'Poppins, sans-serif'
            }
          }
        ],
        backgroundColor: '#333333'
      };

      const barOption = {
        title: {
          text: 'Number of Cinemas per Borough Vs Cinema Economic Accessibility',
          left: 'center',
          textStyle: {
            color: '#ffffff',
            fontFamily: 'Poppins, sans-serif'
          }
        },
        tooltip: {
          trigger: 'axis',
          axisPointer: {
            type: 'shadow'
          },
          textStyle: {
            color: '#ffffff',
            fontFamily: 'Poppins, sans-serif'
          },
          backgroundColor: '#333333'
        },
        yAxis: {
          type: 'value',
          name: 'Normalized Cinema Financial Accessibility Index (0-1)',
          nameLocation: 'end',
          nameGap: 55,
          nameTextStyle: {
            color: '#ffffff',
            fontFamily: 'Poppins, sans-serif',
            fontSize: 12,
            rotate: 90 // Rotate y-axis label by 90 degrees
          },
          axisLine: {
            lineStyle: {
              color: '#ffffff'
            }
          },
          axisLabel: {
            color: '#ffffff',
            fontFamily: 'Poppins, sans-serif',
          },
          splitLine: {
            lineStyle: {
              color: '#555555'
            }
          }
        },
        xAxis: {
          type: 'category',
          name: 'London Borough',
          nameLocation: 'middle',
          nameGap: 130, // Increased gap for x-axis label
          nameTextStyle: {
            color: '#ffffff',
            fontFamily: 'Poppins, sans-serif',
            fontSize: 12
          },
          axisLabel: {
            rotate: 45,
            color: '#ffffff',
            fontFamily: 'Poppins, sans-serif',
            fontSize: 10,
            margin: 15
          },
          axisLine: {
            lineStyle: {
              color: '#ffffff'
            }
          },
          data: barData.map(item => item.name)
        },
        animationDurationUpdate: 2000,
        grid: {
          left: '3%',
          right: '4%',
          bottom: '20%', // Adjusted to accommodate x-axis label
          top: '15%',
          containLabel: true
        },
        series: {
          type: 'bar',
          id: 'libraries_change',
          data: barData.map(item => {
            const originalData = data.find(d => d.name === item.name);
            const value = originalData ? originalData.value : 0;
            let color;
            if (value >= 10) {
              color = '#5EF275'; // Updated green
            } else if (value >= 5) {
              color = '#a2dff5'; // Medium blue
            } else {
              color = '#9a63ff'; // Updated purple
            }
            return {
              value: item.value,
              itemStyle: {
                color: color
              }
            };
          }),
          universalTransition: true
        },
        backgroundColor: '#333333'
      };

      let currentOption = mapOption;
      myChart.setOption(mapOption);
      setInterval(function () {
        currentOption = currentOption === mapOption ? barOption : mapOption;
        myChart.setOption(currentOption, true);
      }, 3000);
    });
  </script>
</body>
</html>